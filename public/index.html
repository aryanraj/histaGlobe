<div id="cesiumContainer" class="fullSize">
	<div id="category"></div>
</div>
<style>
      @import url(js/Cesium/Widgets/widgets.css);
      html, body, #cesiumContainer {
          width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
      }
      #category {
		margin: 5px;
		padding: 2px 5px;
		position: absolute;
		z-index: 1;
	  }
  </style>
<script type="text/javascript" src="js/Cesium/Cesium.js"></script>
<script type="text/javascript" src="js/Jquery/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	var viewer = new Cesium.Viewer('cesiumContainer', {
		sceneMode : Cesium.SceneMode.COLUMBUS_VIEW
	});
	var states_entites = {};
	var district_entities = {};
	// viewer.dataSources.add(Cesium.GeoJsonDataSource.load("data/STATE.json"));

	function addButton(label, handler) {
		var button = document.createElement('button');
		button.classList.add('cesium-button');
		button.innerHTML = label;
		button.onclick = handler;
		document.getElementById('category').appendChild(button);
	}

	window.addButton = addButton;
	addButton ('City Wise Mobiles',function(){
		reset();
	//	console.log("hi in rendercity");
		$.ajax({
			type : 'GET',
			url : '/cities',
			dataType : 'json',
			success : function(cities) {
		//			console.log(data);
				/*
				var greenCylinder = viewer.entities.add({
			    name : 'Green cylinder with black outline',
			    position: Cesium.Cartesian3.fromDegrees(79.8477, 14.1473, 2000.0),
			    cylinder : {
			        length : 400000.0,
			        topRadius : 10000.0,
			        bottomRadius : 10000.0,
			        material : Cesium.Color.GREEN.withAlpha(0.5),
			        outline : true,
			        outlineColor : Cesium.Color.DARK_GREEN
			    }
				});
				*/		
				
				for(city in cities)
				{
					var height = 25 * (1000 + cities[city].val1);
					
					/*if(height < 1000)
						height *= 900;
					else if (height <3000)
						height *= 500;
					else if (height < 5000)
						height *= 300;
					else
						height*=20;
					*/
					var greenCircle = viewer.entities.add({
				    position: Cesium.Cartesian3.fromDegrees(parseFloat(cities[city].lon), parseFloat(cities[city].lat)),
				    name : cities[city].name + " \n Number : " + cities[city].val1,
				    ellipse : {
				        semiMinorAxis : 30000.0,
				        semiMajorAxis : 30000.0,
				        material : Cesium.Color.fromRandom({
								alpha : 1
						}),
				    	extrudedHeight : height,
				    	
				    }
					});
			//		console.log(greenCircle);
			//		break;
			//		greenCircle.propertyNames.value = cities[city].val1;
				}
			}
		});

	});	

	addButton ('City Wise Cars',function(){
		reset();
	//	console.log("hi in rendercity");
		$.ajax({
			type : 'GET',
			url : '/cities',
			dataType : 'json',
			success : function(cities) {
		//			console.log(data);
				/*
				var greenCylinder = viewer.entities.add({
			    name : 'Green cylinder with black outline',
			    position: Cesium.Cartesian3.fromDegrees(79.8477, 14.1473, 2000.0),
			    cylinder : {
			        length : 400000.0,
			        topRadius : 10000.0,
			        bottomRadius : 10000.0,
			        material : Cesium.Color.GREEN.withAlpha(0.5),
			        outline : true,
			        outlineColor : Cesium.Color.DARK_GREEN
			    }
				});
				*/		
				
				for(city in cities)
				{
					var height = 25 * (1000 + cities[city].val2);
					
					/*if(height < 1000)
						height *= 900;
					else if (height <3000)
						height *= 500;
					else if (height < 5000)
						height *= 300;
					else
						height*=20;
					*/
					var greenCircle = viewer.entities.add({
				    position: Cesium.Cartesian3.fromDegrees(parseFloat(cities[city].lon), parseFloat(cities[city].lat)),
				    name : cities[city].name + " \n Number : " + cities[city].val2,
				    ellipse : {
				        semiMinorAxis : 30000.0,
				        semiMajorAxis : 30000.0,
				        material : Cesium.Color.fromRandom({
								alpha : 1
						}),
				    	extrudedHeight : height,
				    	
				    }
					});
			//		console.log(greenCircle);
			//		break;
			//		greenCircle.propertyNames.value = cities[city].val1;
				}
			}
		});

	});	

	addButton ('City Wise bikes',function(){
		reset();
	//	console.log("hi in rendercity");
		$.ajax({
			type : 'GET',
			url : '/cities',
			dataType : 'json',
			success : function(cities) {
		//			console.log(data);
				/*
				var greenCylinder = viewer.entities.add({
			    name : 'Green cylinder with black outline',
			    position: Cesium.Cartesian3.fromDegrees(79.8477, 14.1473, 2000.0),
			    cylinder : {
			        length : 400000.0,
			        topRadius : 10000.0,
			        bottomRadius : 10000.0,
			        material : Cesium.Color.GREEN.withAlpha(0.5),
			        outline : true,
			        outlineColor : Cesium.Color.DARK_GREEN
			    }
				});
				*/		
				
				for(city in cities)
				{
				//	console.log("it is ");
				//	console.log(parseInt(cities[city].lon));
				//	console.log(parseInt(cities[city].lat));
					var height = 25 * (1000 + cities[city].val3);
					
					/*if(height < 1000)
						height *= 900;
					else if (height <3000)
						height *= 500;
					else if (height < 5000)
						height *= 300;
					else
						height*=20;
					*/
					var greenCircle = viewer.entities.add({
				    position: Cesium.Cartesian3.fromDegrees(parseFloat(cities[city].lon), parseFloat(cities[city].lat)),
				    name : cities[city].name + " \n Number : " + cities[city].val3,
				    ellipse : {
				        semiMinorAxis : 30000.0,
				        semiMajorAxis : 30000.0,
				        material : Cesium.Color.fromRandom({
								alpha : 1
						}),
				    	extrudedHeight : height,
				    	
				    }
					});
			//		console.log(greenCircle);
			//		break;
			//		greenCircle.propertyNames.value = cities[city].val1;
				}
			}
		});

	});	

	addButton ('City Wise One ',function(){
		reset();
		console.log("hi in rendercity");
		$.ajax({//
			type : 'GET',
			url : '/cities',
			dataType : 'json',
			success : function(cities) {
		//			console.log(data);
				/*
				var greenCylinder = viewer.entities.add({
			    name : 'Green cylinder with black outline',
			    position: Cesium.Cartesian3.fromDegrees(79.8477, 14.1473, 2000.0),
			    cylinder : {
			        length : 400000.0,
			        topRadius : 10000.0,
			        bottomRadius : 10000.0,
			        material : Cesium.Color.GREEN.withAlpha(0.5),
			        outline : true,
			        outlineColor : Cesium.Color.DARK_GREEN
			    }
				});
				*/		
				
				for(city in cities)
				{
				//	console.log("it is ");
				//	console.log(parseInt(cities[city].lon));
				//	console.log(parseInt(cities[city].lat));
					var height = 25 * (1000 + cities[city].val4);
					
					/*if(height < 1000)
						height *= 900;
					else if (height <3000)
						height *= 500;
					else if (height < 5000)
						height *= 300;
					else
						height*=20;
					*/
					var greenCircle = viewer.entities.add({
				    position: Cesium.Cartesian3.fromDegrees(parseFloat(cities[city].lon), parseFloat(cities[city].lat)),
				    name : cities[city].name + " \n Number : " + cities[city].val4,
				    ellipse : {
				        semiMinorAxis : 30000.0,
				        semiMajorAxis : 30000.0,
				        material : Cesium.Color.fromRandom({
								alpha : 1
						}),
				    	extrudedHeight : height,
				    	
				    }
					});
			///		console.log(greenCircle);
			//		break;
			//		greenCircle.propertyNames.value = cities[city].val1;
				}
			}
		});

	});	


	function reset() {
		viewer.entities.removeAll();
		viewer.dataSources.removeAll();
	}

	function setDataState(id) {
		reset();
		$.ajax({
			type : 'GET',
			url : '/category/state/'+id,
			dataType : 'json',
			success : function(data) {
				renderSTATE(data);
			}
		})
	}

	function setDataDistrict(id) {
		reset();
		$.ajax({
			type : 'GET',
			url : '/category/district/'+id,
			dataType : 'json',
			success : function(data) {
				renderDISTRICT(data);
			}
		})
	}

	function addMouseHoverHandler() {
		var scene = viewer.scene;
		handler = new Cesium.ScreenSpaceEventHandler(scene.canvas);
		handler.setInputAction(function(movement){
			var pickedObject = scene.pick(movement.endPosition);
			entity = pickedObject.id;
		}, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
	}

	// var STATE = Cesium.GeoJsonDataSource.load("data/STATE.json");
	// var DISTRICT = Cesium.GeoJsonDataSource.load("data/DISTRICT.json");

	var STATE, DISTRICT, stateSelected = '';

	function renderSTATE(data) {
		reset();
		var dataSource = STATE;
		// viewer.dataSources.add(dataSource);
		var entities = dataSource.entities.values;
		var colorHash = {};
		for (var i = 0; i < entities.length; i++) {
			
			var entity = entities[i];
			var name = entity.properties.ST_NM;
			
			if(!(name in colorHash))
				colorHash[name] = Cesium.Color.fromRandom({
					alpha : 1
			});
			
			if(!(name in states_entites))
				states_entites[name] = [];

			states_entites[name].push(entity);
			
			viewer.entities.add(entity);

			color = colorHash[name];

			entity.properties.value = data[name];

			entity.polygon.material = color;
			entity.polygon.outline = false;
			entity.polygon.extrudedHeight = data[name];
			
		}
		viewer.camera.setView({
			position : Cesium.Cartesian3.fromDegrees(78.0, 25.0)
		});
		viewer.camera.moveBackward(7000000);
	}

	function renderDISTRICT(data) {
		reset();
		var dataSource = DISTRICT;

		var entities = dataSource.entities.values;
		var colorHash = {};
		for (var i = 0; i < entities.length; i++) {
			
			var entity = entities[i];
			var state_name = entity.properties.ST_NM;

			if(state_name == stateSelected || stateSelected == '') {
				var name = entity.properties.DISTRICT;
				if(!(name in colorHash))
					colorHash[name] = Cesium.Color.fromRandom({
						alpha : 1
				});
				if(!(name in states_entites))
				states_entites[name] = [];

				states_entites[name].push(entity);
				
				viewer.entities.add(entity);

				color = colorHash[name];

				entity.properties.value = data[name];

				entity.polygon.material = color;
				entity.polygon.outline = false;
				if(name in data)
					entity.polygon.extrudedHeight = data[name]*25;
				
			}
			viewer.camera.setView({
				position : Cesium.Cartesian3.fromDegrees(78.0, 25.0)
			});
			viewer.camera.moveBackward(7000000);
		}
	}
	/*function renderCity() {
		console.log("hi in rendercity");
		$.ajax({
			type : 'GET',
			url : '/cities',
			dataType : 'json',
			success : function(data) {
				console.log(data);
			}
		});
	}*/
	window.setDataDistrict = setDataDistrict;
	
	Cesium.GeoJsonDataSource.load("data/STATE.json").then(function(dataSource) {
		STATE = dataSource;
		setDataState(71);
	});

	Cesium.GeoJsonDataSource.load("data/DISTRICT.json").then(function(dataSource) {
		DISTRICT = dataSource;
	});

	$.ajax({
		type : 'GET',
		url : '/list/category',
		dataType : 'json',
		success : function(data) {
			for(var id in data) {
				addButton("State Wise "+data[id], function(event){
					setDataState(this.id);
				}.bind({id:id}))
				addButton("District Wise "+data[id], function(event){
					setDataDistrict(this.id);
				}.bind({id:id}))
			}
		}
	});

});

</script>
